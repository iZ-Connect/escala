<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Escala de Servi√ßo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; background: radial-gradient(circle at top, #0b1220, #020617); margin: 0; padding: 20px; color: #e5e7eb; }
  .container { max-width: 1100px; margin: auto; }
  h1, h2 { text-align: center; }
  .menu { text-align: center; margin: 20px 0; }
  select { padding: 10px 16px; border-radius: 8px; background: #0f172a; color: #f9fafb; border: 1px solid #334155; }
  table { width: 100%; border-collapse: collapse; background: #020617; border-radius: 10px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.8); }
  th, td { padding: 12px; border-bottom: 1px solid #0f172a; text-align: left; }
  th { background: #0f172a; text-transform: uppercase; font-size: 13px; color: #94a3b8; }
  tr.weekend { background: #2a1414 !important; }
  .ferias { background: #0f172a; margin-top: 40px; padding: 20px; border-radius: 10px; }
  footer { text-align: center; margin-top: 30px; font-size: 12px; color: #94a3b8; }
</style>
</head>
<body>

<div class="container">
  <h1>üìã Escala de Servi√ßo</h1>
  <div class="menu">
    <select id="mesSelect" onchange="carregarEscala()">
      <option value="JANEIRO">JANEIRO</option>
      <option value="FEVEREIRO">FEVEREIRO</option>
      <option value="MAR√áO">MAR√áO</option>
      <option value="ABRIL">ABRIL</option>
      <option value="MAIO">MAIO</option>
      <option value="JUNHO">JUNHO</option>
      <option value="JULHO">JULHO</option>
      <option value="AGOSTO">AGOSTO</option>
      <option value="SETEMBRO">SETEMBRO</option>
      <option value="OUTUBRO">OUTUBRO</option>
      <option value="NOVEMBRO">NOVEMBRO</option>
      <option value="DEZEMBRO">DEZEMBRO</option>
    </select>
  </div>

  <table>
    <thead>
      <tr>
        <th>Data</th>
        <th>Dia</th>
        <th>Militar</th>
        <th>Substitu√≠do</th>
      </tr>
    </thead>
    <tbody id="escalaBody"></tbody>
  </table>

  <div class="ferias">
    <h2>üå¥ Militares de F√©rias / Afastados</h2>
    <ul id="listaFerias" style="list-style: none; padding: 0;"></ul>
  </div>

  <footer>Sistema de Escala ‚Ä¢ Atualizado via Google Sheets</footer>
</div>

<script>
// ID DE PUBLICA√á√ÉO EXTRA√çDO DA SUA IMAGEM
const publicId = "2PACX-1vSY-50o70qUzrkbHdsexVzUf1gmb2dtx6k4lG2vw3HwaY6rfdluFtSpOyXvuSJAlnqhw9S5fPq48mXo";

function parseCSV(text) {
  const lines = text.split(/\r?\n/);
  return lines.map(line => line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/));
}

function carregarEscala() {
  const mes = document.getElementById("mesSelect").value;
  const url = `https://docs.google.com/spreadsheets/d/e/${publicId}/pub?output=csv&sheet=${encodeURIComponent(mes)}`;

  fetch(url)
    .then(res => res.text())
    .then(csv => {
      if (csv.includes("<!DOCTYPE") || csv.length < 10) throw new Error();
      const rows = parseCSV(csv);
      const tbody = document.getElementById("escalaBody");
      tbody.innerHTML = "";

      rows.slice(1).forEach(r => {
        const data = r[0]?.replace(/"/g, '').trim();
        const dia = r[1]?.replace(/"/g, '').trim();
        const militar = r[3]?.replace(/"/g, '').trim(); // Coluna D
        const substituto = r[4]?.replace(/"/g, '').trim(); // Coluna E

        if (!data || data === "" || data.toUpperCase().includes("DATA")) return;

        const tr = document.createElement("tr");
        if (dia.toUpperCase().includes("S√ÅB") || dia.toUpperCase().includes("DOM")) {
          tr.classList.add("weekend");
        }

        tr.innerHTML = `<td>${data}</td><td>${dia}</td><td>${militar || "-"}</td><td>${substituto || "-"}</td>`;
        tbody.appendChild(tr);
      });
    })
    .catch(() => {
      document.getElementById("escalaBody").innerHTML = "<tr><td colspan='4' style='text-align:center;'>Aba '"+mes+"' n√£o encontrada ou planilha n√£o publicada como CSV.</td></tr>";
    });
}

function carregarFerias() {
  const url = `https://docs.google.com/spreadsheets/d/e/${publicId}/pub?output=csv&sheet=F√âRIAS E AFASTADOS`;
  fetch(url).then(res => res.text()).then(csv => {
    const rows = parseCSV(csv);
    const ul = document.getElementById("listaFerias");
    ul.innerHTML = "";
    rows.slice(1).forEach(r => {
      const nome = r[0]?.replace(/"/g, '').trim();
      if (nome) {
        const li = document.createElement("li");
        li.style.padding = "10px 0";
        li.innerHTML = `<strong>${nome}</strong> ‚Äî ${r[1]?.replace(/"/g, '') || "Per√≠odo n√£o informado"}`;
        ul.appendChild(li);
      }
    });
  });
}

carregarEscala();
carregarFerias();
</script>
</body>
</html>
