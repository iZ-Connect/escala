<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Escala de Servi√ßo - HGeSM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: 'Segoe UI', Arial, sans-serif; background: radial-gradient(circle at top, #0b1220, #020617); margin: 0; padding: 20px; color: #e5e7eb; }
  .container { max-width: 1000px; margin: auto; }
  h1, h2 { text-align: center; color: #f8fafc; }
  .menu { text-align: center; margin: 20px 0; }
  select { padding: 12px 20px; border-radius: 8px; background: #1e293b; color: #f8fafc; border: 1px solid #334155; font-size: 16px; cursor: pointer; }
  table { width: 100%; border-collapse: collapse; background: #0f172a; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
  th, td { padding: 14px; border-bottom: 1px solid #1e293b; text-align: left; }
  th { background: #1e293b; text-transform: uppercase; font-size: 12px; color: #94a3b8; letter-spacing: 0.05em; }
  tr.weekend { background: #451a1a !important; } /* Cor para S√°bado e Domingo */
  tr:hover { background: #1e293b; }
  .ferias-section { background: #0f172a; margin-top: 40px; padding: 25px; border-radius: 12px; border: 1px solid #1e293b; }
  .ferias-list { list-style: none; padding: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
  .ferias-item { background: #1e293b; padding: 12px; border-radius: 6px; border-left: 4px solid #3b82f6; }
  footer { text-align: center; margin-top: 40px; font-size: 12px; color: #64748b; }
</style>
</head>
<body>

<div class="container">
  <h1>üìã Escala de Servi√ßo - HGeSM</h1>
  
  <div class="menu">
    <select id="mesSelect" onchange="carregarEscala()">
      <option value="JANEIRO">JANEIRO</option>
      <option value="FEVEREIRO">FEVEREIRO</option>
      <option value="MAR√áO">MAR√áO</option>
      <option value="ABRIL">ABRIL</option>
      <option value="MAIO">MAIO</option>
      <option value="JUNHO">JUNHO</option>
      <option value="JULHO">JULHO</option>
      <option value="AGOSTO">AGOSTO</option>
      <option value="SETEMBRO">SETEMBRO</option>
      <option value="OUTUBRO">OUTUBRO</option>
      <option value="NOVEMBRO">NOVEMBRO</option>
      <option value="DEZEMBRO">DEZEMBRO</option>
      <option value="JANEIRO ANO NOVO">JANEIRO 2026</option>
    </select>
  </div>

  <table id="escalaTabela">
    <thead>
      <tr>
        <th>Data</th>
        <th>Dia</th>
        <th>Militar</th>
        <th>Substitu√≠do</th>
      </tr>
    </thead>
    <tbody id="escalaBody">
      </tbody>
  </table>

  <div class="ferias-section">
    <h2>üå¥ Militares em F√©rias / Afastados</h2>
    <div id="listaFerias" class="ferias-list"></div>
  </div>

  <footer>Sistema de Escala ‚Ä¢ Atualizado via Google Sheets</footer>
</div>

<script>
// ID da sua planilha conforme imagem enviada
const publicId = "2PACX-1vSY-50o70qUzrkbHdsexVzUf1gmb2dtx6k4lG2vw3HwaY6rfdluFtSpOyXvuSJAlnqhw9S5fPq48mXo";

function parseCSV(text) {
    const lines = text.split(/\r?\n/);
    return lines.map(line => {
        // Lida com v√≠rgulas dentro de aspas (comum em CSV do Google)
        const matches = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
        return matches ? matches.map(m => m.replace(/^"|"$/g, '')) : line.split(',');
    });
}

async function carregarEscala() {
    const mes = document.getElementById("mesSelect").value;
    const url = `https://docs.google.com/spreadsheets/d/e/${publicId}/pub?output=csv&sheet=${encodeURIComponent(mes)}`;
    const tbody = document.getElementById("escalaBody");
    
    tbody.innerHTML = "<tr><td colspan='4' style='text-align:center'>Carregando dados...</td></tr>";

    try {
        const response = await fetch(url);
        const data = await response.text();
        const rows = parseCSV(data);
        
        tbody.innerHTML = "";
        
        // Come√ßa da linha 1 para pular o cabe√ßalho
        rows.slice(1).forEach(cols => {
            if (cols.length < 4 || !cols[0] || cols[0].includes("DATA")) return;

            const tr = document.createElement("tr");
            const diaSemana = cols[1] ? cols[1].toUpperCase() : "";

            // Destaca fins de semana conforme padr√£o militar
            if (diaSemana.includes("S√ÅB") || diaSemana.includes("DOM")) {
                tr.classList.add("weekend");
            }

            tr.innerHTML = `
                <td>${cols[0]}</td>
                <td>${cols[1]}</td>
                <td>${cols[3] || "-"}</td>
                <td>${cols[4] || "-"}</td>
            `;
            tbody.appendChild(tr);
        });
    } catch (error) {
        tbody.innerHTML = "<tr><td colspan='4' style='text-align:center; color:#f87171'>Erro ao carregar escala. Verifique a publica√ß√£o da planilha.</td></tr>";
    }
}

async function carregarFerias() {
    const url = `https://docs.google.com/spreadsheets/d/e/${publicId}/pub?output=csv&sheet=F√âRIAS e AFASTADOS`;
    const container = document.getElementById("listaFerias");

    try {
        const response = await fetch(url);
        const data = await response.text();
        const rows = parseCSV(data);
        
        container.innerHTML = "";

        rows.slice(1).forEach(cols => {
            if (!cols[0] || cols[0].trim() === "") return;

            const div = document.createElement("div");
            div.className = "ferias-item";
            div.innerHTML = `<strong>${cols[0]}</strong><br><small>Per√≠odo: ${cols[2] || '?'} at√© ${cols[3] || '?'}</small>`;
            container.appendChild(div);
        });
    } catch (e) {
        container.innerHTML = "<p>Informa√ß√µes de f√©rias indispon√≠veis.</p>";
    }
}

// Inicializa√ß√£o
carregarEscala();
carregarFerias();
</script>
</body>
</html>
